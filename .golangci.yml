# golangci-lint v2 configuration
# Documentation: https://golangci-lint.run/usage/configuration/

version: "2"

run:
  timeout: 5m
  tests: true
  modules-download-mode: readonly

# Output configuration.
output:
  formats:
    text:
      path: stdout
      colors: true
      print-issued-lines: true
      print-linter-name: true
  sort-results: true

linters:
  default: none
  enable:
    # Default linters.
    - errcheck      # Checks for unchecked errors.
    - govet         # Reports suspicious constructs.
    - ineffassign   # Detects ineffectual assignments.
    - staticcheck   # Staticcheck is a go vet on steroids (includes gosimple in v2).
    - unused        # Checks for unused constants, variables, functions and types.

    # Additional recommended linters.
    - misspell      # Finds commonly misspelled English words.
    - revive        # Fast, configurable, extensible, flexible, and beautiful linter for Go.
    - gocyclo       # Computes cyclomatic complexities.
    - goconst       # Finds repeated strings that could be replaced by a constant.
    - gosec         # Inspects source code for security problems.
    - unconvert     # Remove unnecessary type conversions.
    - unparam       # Reports unused function parameters.
    - nakedret      # Finds naked returns in functions greater than a specified length.
    - gocognit      # Computes cognitive complexities.
    - godot         # Check if comments end in a period.
    - whitespace    # Detection of leading and trailing whitespace.

  settings:
    gocyclo:
      # Minimal cyclomatic complexity to report.
      min-complexity: 15

    gocognit:
      # Minimal cognitive complexity to report.
      min-complexity: 15

    goconst:
      # Minimal length of string constant.
      min-len: 3
      # Minimum occurrences to report.
      min-occurrences: 3

    gosec:
      # Exclude some checks.
      excludes:
        - G104  # Audit errors not checked (we use errcheck for this).

    revive:
      confidence: 0.8
      rules:
        - name: blank-imports
        - name: context-as-argument
        - name: context-keys-type
        - name: dot-imports
        - name: error-return
        - name: error-strings
        - name: error-naming
        - name: exported
        - name: if-return
        - name: increment-decrement
        - name: var-naming
        - name: var-declaration
        - name: package-comments
        - name: range
        - name: receiver-naming
        - name: time-naming
        - name: unexported-return
        - name: indent-error-flow
        - name: errorf
        - name: empty-block
        - name: superfluous-else
        - name: unused-parameter
        - name: unreachable-code
        - name: redefines-builtin-id

    nakedret:
      # Make an issue if func has more lines of code than this setting and has naked return.
      max-func-lines: 30

    unparam:
      # Check exported functions.
      check-exported: false

    whitespace:
      multi-if: false
      multi-func: false

  exclusions:
    # Equivalent to v1's exclude-use-default: true.
    presets:
      - comments
      - common-false-positives
      - legacy
      - std-error-handling
    rules:
      # Exclude some linters from running on test files.
      - path: _test\.go
        linters:
          - gocyclo
          - gocognit
          - errcheck
          - gosec
          - unparam
          - revive
          - goconst
          - godot
          - whitespace

      # Exclude known issues in vendor.
      - path: vendor/
        linters:
          - all

      # Ignore "new" parameter name shadowing built-in.
      - text: "redefines-builtin-id"
        linters:
          - revive

      # Ignore integer overflow in CRC16 - this is intentional and safe.
      - text: "G115.*integer overflow"
        path: internal/cmdx/slot.go
        linters:
          - gosec

formatters:
  enable:
    - gofmt
    - goimports
    - gci
  settings:
    gofmt:
      simplify: true
    goimports:
      local-prefixes: github.com/dcbickfo/redcache
    gci:
      sections:
        - standard
        - default
        - prefix(github.com/dcbickfo/redcache)
  exclusions:
    paths:
      - vendor/

issues:
  max-per-linter: 50
  max-same-issues: 3
  new: false
  fix: false
